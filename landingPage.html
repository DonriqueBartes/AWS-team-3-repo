<!DOCTYPE html>
<html>
  <head>
    <meta charset='utf-8'>
    <meta http-equiv='X-UA-Compatible' content='IE=edge'>
    <meta name='viewport' content='width=device-width, initial-scale=1'>
        
    <title>Select Your Taste</title>
    <link rel="icon" type="image/x-icon" href="/images/logo.png">
    <link rel="stylesheet" type='text/css' href="styles.css">
    
    <script src="node_modules/amazon-cognito-auth-js/dist/amazon-cognito-auth.min.js"></script>
    <script src="https://sdk.amazonaws.com/js/aws-sdk-2.7.16.min.js"></script>
    <script src="node_modules/amazon-cognito-identity-js/dist/amazon-cognito-identity.min.js"></script>
    <script src="index.js"></script>
    <script src="config.js"></script>
  </head>

  <body class ="body">

    <!-- Done: Header -->
    <button class="open-button" id="formid"  onclick="openForm()">Login/Sign Up</button>
    <img class="logo-image" src="./images/logo.png">

    <div id="loginForm" class="form-popup">
      <form class="form-container">
        <h1>Login</h1>

        <input type="email" id="inputUsername" placeholder="Email" name="email" required>
        <input type="password" id="inputPassword" placeholder="Password" name="loginPassword" required>
        
        <button type="button" id="confirm-login" class="btn" onclick="signInButton()">Login</button>
        <button type="button" class="btn cancel" onclick="closeLogin()">Close</button>

        <button type="button" class="formbutton" id="" onclick=openRegister()>Don't have an account? Sign up</a></button><br>
        <a href="./forgotpswd.html" class="formbutton" >Forgot Password</a>
      </form>


    </div>

    <div id="registerForm" class="form-popup">
      <form class="form-container">
        <h1>Register</h1>

        <input type="personalname" id="personalnameRegister" placeholder="Username" name="name" required>
        <input type="email" id="emailInputRegister" placeholder=" Email" name="email" required>   
        <input type="password" id="passwordInputRegister" placeholder="Password" name="psw" required>
        <input type="password" id="confirmationpassword" placeholder="Password" name="psw" required>

        <button type="button" id="registerBtn" class="btn" onclick="registerButton()">Register</button>
        <button type="button" class="btn cancel" onclick="closeRegister()">Close</button>
      </form>
    </div>

    <div id="current-login" class="form-popup">
      <form class="form-container">
        <h3>Currently logged in as:<br></h3>
        <label id="currentUser">UserExample</label>
        <br>
        <button type="button" class="formbutton" onclick="signOut()">Sign Out</button>
        <label id="email_value"></label>
        <button type="button" class="btn cancel" onclick="closeCurrentLogin()">Close</button>
      </form>
    </div>
    <!--Navi for food selection-->
    
      <!-- Done: Category Navigation Bar-->
      <div class = "container-button">
          <button id="italian" class='btn-catg' onclick='findFood(this.value)' value="italian">Italian </button>
          <button id="steak" class='btn-catg' onclick='findFood(this.value)' value="steakhouses">Steakhouses</button>
          <button id="sushi" class='btn-catg' onclick='findFood(this.value)' value="sushi">Sushi</button>
          <button id="indian" class='btn-catg' onclick='findFood(this.value)' value="indian">Indian</button>
          <button id="dessert" class='btn-catg' onclick='findFood(this.value)' value="dessert">Dessert</button>
          <button id="coffee" class='btn-catg' onclick='findFood(this.value)' value="coffee">Coffee</button>
      </div>
    
    <div class="container-image">
        <!-- Calls to the json file to get restuarant details -->
        <div class= "data-out" id="data-output"></div>
    </div>

    <!-- Calls Modal -->
    <div class= "data-out" id="output-stuff"></div>

  <!-- END OF PAGE -->
  </body> 
  <script>
    var data = {
    UserPoolId : _config.cognito.userPoolId,
    ClientId : _config.cognito.clientId
    };
    var userPool = new AmazonCognitoIdentity.CognitoUserPool(data);
    var cognitoUser = userPool.getCurrentUser();

    window.onload = function(){
        if (cognitoUser != null){
            cognitoUser.getSession(function(err, session) {
                if (err) {
                    alert(err);
                    return;
                }
                console.log('session validity: ' + session.isValid());
                document.getElementById("formid").setAttribute( "onClick","openCurrent();");

                // Set the profile info
                cognitoUser.getUserAttributes(function(err, result) {
                    if (err) {
                        console.log(err);
                        return;
                    }
                    console.log(result);
                    document.getElementById("formid").innerHTML = result[3].getValue();
                    document.getElementById("currentUser").innerHTML = result[2].getValue();
                });
            });
        }
    }

    function signOut(){
        if(cognitoUser != null){
            cognitoUser.signOut();
            // alert('Signed Out');
            location.reload();
        }
    }
  </script>
</html>